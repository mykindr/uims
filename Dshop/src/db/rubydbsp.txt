
#采购记录追加现有库存
insert into stocks (pid,goodsname,color,amount,bundle,inprice,volume) select cpbh as pid,cpmc as goodsname, ys as color, sum(sl) as amount, sum(js) as bundle, sum(dj) as inprice, tj as volume from purchases group by cpbh;


#维修库存
select pid,barcode,goodsname,size,color,volume,unit,inprice,pfprice,amount,bundle,discount,remark from afterselldetails where not(status) and type="维修";

#根据客户电话查询维修库存
select d.pid,barcode,d.goodsname,d.size,d.color,d.volume,d.unit,d.inprice,d.pfprice,d.amount,d.bundle,d.discount,d.remark from aftersellmains m, afterselldetails d where not(d.status) and d.type="维修" and m.tid=d.tid and m.custtel="130000";



#从维修库存增加产品进行出库
update selllogdetails sd, aftersellmains am, afterselldetails ad set sd.amount=if(ad.ramount>0,(sd.amount+1),sd.amount), ad.ramount=if(ad.ramount>0,(ad.ramount-1),ad.ramount),sd.updated_at=now() where sd.slid="' + Label26.Caption + '" and sd.pid="' + ADOQuery1.FieldByName('pid').AsString + '" and not(ad.status) and ad.type="维修" and ad.tid=am.tid and am.custtel="' + edt2.Text + '" and sd.pid=ad.pid;


#取消从维修库存增加产品进行出库
update selllogdetails sd, aftersellmains am, afterselldetails ad set sd.amount=if(ad.ramount<ad.amount,(sd.amount-1),sd.amount), ad.ramount=if(ad.ramount<ad.amount,(ad.ramount+1),ad.ramount),sd.updated_at=now() where sd.slid="' + Label26.Caption + '" and sd.pid="' + ADOQuery1.FieldByName('pid').AsString + '" and not(ad.status) and ad.type="维修" and ad.tid=am.tid and am.custtel="' + edt2.Text + '" and sd.pid=ad.pid;