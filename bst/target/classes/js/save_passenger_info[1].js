function submit_form_confirm(formId){if(!submit_form_check(formId)){return false;}cardflag=false;var ticket_info=getTicketInfo();var passenger_info=getPassengerInfo();var titile="提交订单确认";var msgtext='<div class="submit-tips">';msgtext+='<div class="submit-cont">';msgtext+='<p>您所要提交的订单信息如下，请确定是否正确（<font color="red">点击“确定”提交订单，点击“取消”返回修改</font>）。</p>';msgtext+='<div class="title">车次信息</div>';msgtext+=ticket_info;msgtext+='<div class="title">乘车人信息</div>';msgtext+=passenger_info;if((to_station_code_=="LSO"||to_station_code_=="DAO"||to_station_code_=="ADO"||to_station_code_=="NQO"||to_station_code_=="THO")&&cardflag==true){msgtext+='<p style="color:#3177BF;">注：1.系统将根据售出情况随机为您申请席位，暂不支持自选席位。</p>';msgtext+='<p style="color:#3177BF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.根据现行规定，外国人在购买进西藏火车票时，须出示西藏自治区外事办公室或旅游局、商务厅的批准函（电），或者出示中国内地司局级接待单位出具的、已征得自治区上述部门同意的证明信函。台湾同胞赴藏从事旅游、商务活动，须事先向西藏自治区旅游局或商务厅提出申请，购买进藏火车票时须出示有关批准函。</p>';}else{msgtext+='<p style="color:#3177BF;">注：系统将根据售出情况随机为您申请席位，暂不支持自选席位。</p>';}msgtext+="</div></div>";var buttonOk="取   消 ";var buttonNo="确   定 ";parent.pop_confirm(titile,msgtext,failfunc,successfunc,buttonNo,buttonOk,692);submitfunction.apply(this);}var submitfunction=function(){};var successfunc=function(){$(":button").attr("disabled",false);$(":button").removeClass("long_button_x");};var failfunc=function(){$(":button").attr("disabled",true);$(":button").addClass("long_button_x");submit_form("confirmPassenger");};function getTicketInfo(){var ticket_info='<table width="100%" cellpadding="0" cellspacing="0" class="table-info">';ticket_info+="  <tr>";ticket_info+="    <td>"+getTrainDate(train_date_str_)+"</td>";ticket_info+="    <td>"+station_train_code_+"次</td>";ticket_info+="    <td>"+from_station_name_+"("+start_time_str_+"开)</td>";ticket_info+="    <td>————</td>";ticket_info+="    <td>"+to_station_name_+"("+arrive_time_str_+"到)</td>";ticket_info+="  </tr>";ticket_info+="</table>";return ticket_info;}function getTrainDate(train_date){var df1=new DateFormat("yyyy-MM-dd");var dt1=df1.parse(train_date);var df2=new DateFormat("yyyy年MM月dd日");var train_date_format=df2.format(dt1);return train_date_format;}function getLishi(lishi){var df1=new DateFormat("HH:mm");var dt1=df1.parse(lishi);var df2=new DateFormat("HH小时mm分钟");var lishi_format=df2.format(dt1);return lishi_format;}function getPassengerInfo(){var passenger_info='<table border="0" cellpadding="0" cellspacing="0" class="table_infolist">';passenger_info+="<tr>";passenger_info+='<th width="50">序号</th>';passenger_info+='<th width="90">席别</th>';passenger_info+='<th width="90">票种</th>';passenger_info+='<th width="150">姓名</th>';passenger_info+='<th width="100">证件类型</th>';passenger_info+='<th width="">证件号码</th>';passenger_info+='<th width="100">手机号</th>';var no_=0;$(".passenger_class").each(function(index){if(this.style.display=="none"){return false;}var id=$(this).attr("id");var _isSave=$("#"+id+"_isSave")[0].checked;var _type=$("#_type").val();if(_type==null||_type==""||_type=="null"||_isSave&&(_type=="resign"||_type=="back")){no_++;var value="<tr><td>"+no_+"</td>";value+='<td align="center">'+$("#"+id+"_seat").find("option:selected").text()+"</td>";value+="<td>"+$("#"+id+"_ticket").find("option:selected").text()+"</td>";value+="<td>"+$("#"+id+"_name").val()+"</td>";if($("#"+id+"_cardtype").find("option:selected").text()=="护照"){cardflag=true;}value+="<td>"+$("#"+id+"_cardtype").find("option:selected").text()+"</td>";value+="<td>"+$("#"+id+"_cardno").val()+"</td>";value+="<td>"+$("#"+id+"_mobileno").val()+"</td>";passenger_info+=value;}});passenger_info+="</tr>";passenger_info+="</table>";return passenger_info;}function submit_form_check(formId){var checkCardType=[];var isSelectOne=false;var noSelects=[];function toPassengerStringSplit(passenger){var pValue=passenger.passenger_name+","+passenger.passenger_id_type_code+","+passenger.passenger_id_no;return pValue;}var _seat_codes_resign=[];$(".passenger_class").each(function(){var id=$(this).attr("id");if(this.style.display=="none"){return false;}var value=$("#"+id+"_seat").val();if($("#"+id+"_isSave")[0].checked){_seat_codes_resign.push($("#"+id+"_seat").val());}value+=","+$("#"+id+"_ticket").val();value+=","+$("#"+id+"_name").val();value+=","+$("#"+id+"_cardtype").val();value+=","+$("#"+id+"_cardno").val();value+=","+$("#"+id+"_mobileno").val();if($("#"+id+"_isSave")[0].checked){value+=","+$("#"+id+"_isSave").val();isSelectOne=true;}else{value+=",N";noSelects.push(id+"_p");}if($("#"+id+"_ticket").val()!==ticket_type_code.child){checkCardType.push({name:$("#"+id+"_name").val(),cardno:$("#"+id+"_cardno").val(),cardtype:$("#"+id+"_cardtype").val()});}$("#"+id+"_p").val(value);var passenger=$("#"+id).data("passenger");if(passenger){$("#"+id+"_old").val(toPassengerStringSplit(passenger));}});if($("#_type").val()=="resign"){if(!isSupportBatchResign(_seat_codes_resign)){alert("卧铺不支持批量改签，请单张改签！");return false;}if($.unique(_seat_codes_resign).length>1){alert("改签时，必须选择相同席别");return false;}}var isCardSame=false;var cardSameName="";var cardSameCardNo="";$.each(checkCardType,function(index,item){if(item.cardno==""){return false;}$.each(checkCardType,function(index1,item1){if(item.cardtype=="1"){if(index1!=index&&(item1.cardtype=="1"&&item1.cardno==item.cardno||item1.cardtype=="2"&&item1.cardno==getCardNo18(item.cardno))){isCardSame=true;cardSameName=item.name;cardSameCardNo=item.cardno;return false;}}else{if(item.cardtype=="2"){if(index1!=index&&(item1.cardtype=="1"&&getCardNo18(item1).cardno==item.cardno||item1.cardtype=="2"&&item1.cardno==item.cardno)){isCardSame=true;cardSameName=item.name;cardSameCardNo=item.cardno;return false;}}else{if(index1!=index&&(item1.cardtype==item.cardtype)&&(item1.cardno==item.cardno)){isCardSame=true;cardSameName=item.name;cardSameCardNo=item.cardno;return false;}}}});});var id_mode=$("#orderRequest_id_mode").val();var _station_train_code=$("#_station_train_code").val();var _train_date_str=$("#_train_date_str").val();var train_date_str_year=_train_date_str.substr(0,4);var train_date_str_month=_train_date_str.substr(5,2);var train_date_str_day=_train_date_str.substr(8,2);if(isCardSame&&id_mode=="Y"){alert("互联网售票实行实名制："+cardSameCardNo+"只能购买"+train_date_str_year+"年"+train_date_str_month+"月"+train_date_str_day+"日的"+_station_train_code+"次的一张车票！");return;}if($("#_type").val()!==""){if(!isSelectOne){alert("至少选择一位乘客");return false;}}if($("#"+formId).valid()){$(":button").attr("disabled",true);$(":button").addClass("long_button_x");}else{return false;}return true;}function isSupportBatchResign(_seat_codes_resign){var seats_wp="3456ACFGHL";var seat_num=0;$.each(_seat_codes_resign,function(i,val){if(seats_wp.indexOf(val)!=-1){seat_num++;}if(seat_num>=2){return false;}});if(seat_num>=2){return false;}else{return true;}}function submit_form(formId){var sub_form=$("#"+formId);sub_form.target="_self";sub_form.submit();}function getCardNo18(carNo15){var cardNo18;if(carNo15.length==15){cardNo18=idCardUpdate(carNo15);}else{cardNo18=carNo15;}return cardNo18;}function confirmCancel(formId){if(confirm("您确认取消订单吗?")){$(":button").attr("disabled",true);$(":button").addClass("long_button_x");cancelToQuery();}}$(document).ready(function(){var rules={};var messages={};var errorLabelContainer=$("#error_info");$(".passenger_class").each(function(){var id=$(this).attr("id");var seatTypeId=id+"_seat";var ticketTypeId=id+"_ticket";var nameId=id+"_name";var cardNoId=id+"_cardno";var cardTypeId=id+"_cardtype";var mobileNoId=id+"_mobileno";var isSave=id+"_isSave";var checkRealName=cardTypeId+"@"+cardNoId;rules[nameId]={required:true,byteRangeLength:[3,20],checkNameCharBlank:checkRealName};rules[seatTypeId]={required:false,checkSeatType:"#"+isSave};rules[ticketTypeId]={required:true};rules[cardNoId]={required:true,checkIdValidStr:true,isSecIDCard:"#"+cardTypeId,isFirIDCard:"#"+cardTypeId,checkHkongMacao:"#"+cardTypeId,checkTaiw:"#"+cardTypeId,checkPassport:"#"+cardTypeId};rules[mobileNoId]={isMobile:true};messages[seatTypeId]={required:"请选择席别！<br>",checkSeatType:"请选择席别！<br>"};messages[ticketTypeId]={required:"请选择票种！<br>"};messages[nameId]={required:"请输入您的姓名！<br>",byteRangeLength:"允许输入的字符串在3-20个字符之间！<br>",checkNameCharBlank:"姓名只能包含中文或者英文！<br>"};messages[cardNoId]={required:"请输入证件号码！<br>",isSecIDCard:"请正确输入18位的身份证号！<br>",isFirIDCard:"请正确输入15或者18位的身份证号！<br>",checkIdValidStr:"输入的证件编号中包含中文信息或特殊字符！<br>",checkHkongMacao:"请输入有效的港澳居民通行证号码！<br>",checkTaiw:"请输入有效的台湾居民通行证号码！<br>",checkPassport:"请输入有效的护照号码！<br>"};messages[mobileNoId]={isMobile:"您输入的手机号码不是有效的格式！<br>"};});var validate=$("#confirmPassenger").validate({rules:rules,messages:messages,errorLabelContainer:errorLabelContainer,onfocusout:function(element,errorClass,validClass){if(this.check(element)&&this.messages){var messageObject=this.messages[element.id];if(messageObject){messageObject.count--;if(messageObject.count==0){this.errorsFor(messageObject.el).hide();}}$(element).removeClass("error");}},onkeyup:function(){},onclick:function(){}});var showLabel=validate.showLabel;var checkForm=validate.checkForm;validate.checkForm=function(){checkForm.apply(validate);if(this.messages){this.messages=null;}};validate.showLabel=function(element,message){if(!this.messages){this.messages={};}if(this.messages[message]){this.messages[message].count=this.messages[message].count+1;this.messages[element.id]=this.messages[message];return;}else{this.messages[message]={el:element,count:1};this.messages[element.id]=this.messages[message];}showLabel.call(validate,element,message);};});function onStopHover_name(obj){onStopHover(obj,$("#tip_info_div_name"));}function onStopHover_cardtype(obj){onStopHover(obj,$("#tip_info_div_cardtype"));}function onStopHover_name_cardtype(obj){onStopHover(obj,$("#tip_info_div_name_cardtype"));}function onStopHover(obj,obj_div){var div_height=obj_div.height();var position_=$(obj).position();var pos_top=position_.top;var pos_left=position_.left;var pos_top_new=pos_top-div_height;var pos_left_new=pos_left;obj_div.attr("style","display:block;position:absolute;z-index: 120;top:"+pos_top_new+"px;left:"+pos_left_new+"px;");obj_div.show();}function onStopOut(){$("#tip_info_div_name").hide();$("#tip_info_div_cardtype").hide();$("#tip_info_div_name_cardtype").hide();}